<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>플랜 수정</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="/asset/style-detail.css">
</head>
<body>
  <header class="top-header">
    <div class="header-left">
        <a href="/home" class="logo">
            <i class="fas fa-plane-departure"></i> 
            <span class="logo-text">Travel</span>
        </a>
    </div>
    <div class="header-right">
        <button class="header-btn back-btn" onclick="location.href='/home'">
            <div class="cancel-profile">
                <i class="fas fa-times"></i> 
                <span>취소</span>
            </div>
        </button>
        <button class="header-btn delete-btn" onclick="deleteTrip('<%= trip.id %>')">
            <div class="delete-profile">
                <i class="fas fa-trash-alt"></i>
                <span>플랜 삭제</span>
            </div>
        </button>
        <button class="header-btn save-btn" type="submit" class="save-btn" form="edit-form">
            <div class="check-profile">
                <i class="fas fa-check"></i> 
                <span>수정 완료</span>
            </div>
        </button>
    </div>
  </header>

  <div class="bg-icon"><i class="fas fa-plane"></i></div>

  <main class="detail-container" id="trip-container" data-user-id="<%= user.userId %>">
    <section class="board-article">
        
        <div style="text-align:center; margin-bottom:30px;">
            <h2 style="color:#005eff;">플랜 수정하기</h2>
        </div>

        <form id="edit-form" action="/trips/<%= trip.id %>/update" method="POST">
            
            <div class="edit-group">
                <label class="edit-label">여행 주제 (제목)</label>
                <input type="text" class="edit-input" name="topic" value="<%= trip.topic %>" required>
            </div>

            <div class="row-group">
                <div class="edit-group col-half">
                    <label class="edit-label">여행 국가</label>
                    <input type="text" class="edit-input" name="destination" value="<%= trip.destination %>" required>
                </div>
                <div class="edit-group col-half">
                    <label class="edit-label">최대 인원</label>
                    <input type="number" class="edit-input" name="headcount" value="<%= trip.headcount %>" min="1" required>
                </div>
                <div class="edit-group col-half">
                    <label class="edit-label">예산 (원)</label>
                    <input type="text" class="edit-input" name="budget" value="<%= trip.budget %>">
                </div>
            </div>

            <div class="edit-group">
                <label class="edit-label">
                    <i class="fas fa-route" style="color:#005eff;"></i> 여행 코스 설정
                </label>
                <div id="place-list">
                    <% if (trip.places && trip.places.length > 0) { %>
                        <% trip.places.forEach((place) => { %>
                            <div class="place-item">
                                <input type="text" class="edit-input place-input" value="<%= place %>" placeholder="방문지 입력">
                                <button type="button" class="remove-place-btn" onclick="removePlace(this)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="place-item">
                            <input type="text" class="edit-input place-input" placeholder="방문지 입력">
                            <button type="button" class="remove-place-btn" onclick="removePlace(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    <% } %>
                </div>
                <button type="button" class="add-place-btn" onclick="addPlace()">+ 방문지 추가</button>
            </div>

            <div class="edit-group">
                <label class="edit-label">상세 내용</label>
                <textarea class="edit-input" name="description" rows="8"><%= trip.description %></textarea>
            </div>

            <div class="edit-group">
                <label class="edit-label" style="color:#ff4d4d;">
                    <i class="fas fa-user-minus"></i> 참가자 관리
                </label>
                <div class="participant-box">
                    <% if (trip.participants && trip.participants.length > 0) { %>
                        <% trip.participants.forEach(userId => { %>
                            <div class="p-item">
                                <span class="p-name"><i class="fas fa-user"></i> <%= userId %></span>
                                <button type="button" class="p-remove" onclick="leaveTrip('<%= trip.id %>', '<%= userId %>')">
                                    <i class="fas fa-times-circle"></i>
                                </button>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <p style="color:#999999; font-size:14px;">참가자가 없습니다.</p>
                    <% } %>
                </div>
            </div>

            <input type="hidden" name="places" id="places-hidden">
        </form>
    </section>
  </main>

  <script type="module" src="/edit-my-plan.js"></script>
  <script type="module" src="/remove-deleteP-plan.js"></script>
</body>
</html>